# Devlution AI Pipeline â€” GitLab CI Configuration
# Generated by `devlution init --ci gitlab-ci`

stages:
  - devlution

devlution-pipeline:
  stage: devlution
  image: python:3.11-slim
  
  rules:
    - if: '$CI_PIPELINE_SOURCE == "web"'
    - if: '$CI_PIPELINE_SOURCE == "trigger"'
    - if: '$CI_PIPELINE_SOURCE == "schedule"'

  variables:
    ANTHROPIC_API_KEY: $ANTHROPIC_API_KEY
    GITHUB_TOKEN: $GITHUB_TOKEN
    DEVLUTION_SLACK_TOKEN: $SLACK_TOKEN

  before_script:
    - pip install devlution

  script:
    - devlution run
        --trigger ${TRIGGER_TYPE:-manual}
        --config devlution.yaml
        --verbose

  artifacts:
    paths:
      - .devlution/audit.jsonl
    expire_in: 30 days
